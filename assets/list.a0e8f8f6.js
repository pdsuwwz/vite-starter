import{I as p,W as V,i as C,r as c,o as m,s as N,m as l,l as n,t as f,H as w,$ as k,a0 as E,Z as I,O as j,w as b,V as B,M as P,k as v,a2 as F,G as x,u as H,T as M,P as A}from"./vendor.37afc139.js";import{_ as g,c as R,P as y}from"./index.3c204e91.js";import{N as U}from"./NavBar.50515c6c.js";import D from"./ProjectForm.c7f820d7.js";import G from"./TableHeader.00cec940.js";import K from"./TableBody.9d849bae.js";import{l as O}from"./lodash.793e28e0.js";import"./Translations.08c3fd06.js";import"./ProjectItem.f26dc5c5.js";const W=p({name:"NavigationSideLogo",setup(){const e=V();return{title:C(()=>e.t("base.systemTitle"))}}}),Z={class:"side-logo-container"},q=(e=>(k("data-v-3a4210dd"),e=e(),E(),e))(()=>f("img",{class:"side-logo-img",src:"assets/vue.20be1948.svg",alt:"\u5546\u6807"},null,-1)),z={class:"side-logo-title"};var J=g(W,[["render",function(e,a,r,o,t,d){const s=c("router-link");return m(),N("div",Z,[l(s,{to:`/${e.$route.params.locale||""}`},{default:n(()=>[q,f("h1",z,w(e.title),1)]),_:1},8,["to"])])}],["__scopeId","data-v-3a4210dd"]]);const Q=p({name:"SearchSelect",components:{Loading:I},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default:()=>()=>{}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:a}=P(),r=j(!1),o=j("");return b(()=>e.modelValue,t=>{o.value=t},{immediate:!0}),b(()=>o,O.exports.debounce(function(t){a.$emit("update:modelValue",t),a.$emit("change",t)},300)),{loading:r,searchValue:o}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText:e=>e.replace(new RegExp(/(<([^>]+)>)/,"gi"),""),handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,a){const r=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let o=[];if(!r)return void a(o);this.loading=!0,o=await this.fetch(r)||[],o.forEach(t=>{t.label=t.label.replace(new RegExp(r,"gi"),d=>`<span class="search-select-highlight">${d}</span>`)}),a(o),setTimeout(()=>{B(()=>{this.loading=!1})},200)}}}),X=["title","innerHTML"],Y=p({name:"SearchCorporation",components:{SearchSelect:g(Q,[["render",function(e,a,r,o,t,d){const s=c("loading"),u=c("el-icon"),h=c("IconFont"),S=c("el-autocomplete");return m(),v(S,x({modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=i=>e.searchValue=i),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:a[1]||(a[1]=i=>e.keydown(i))}),F({default:n(({item:i})=>[f("span",{title:e.getExecText(i.label),innerHTML:i.label},null,8,X)]),_:2},[e.loading?{name:"suffix",fn:n(()=>[l(u,{class:"search-loading-icon"},{default:n(()=>[l(s)]),_:1})])}:{name:"suffix",fn:n(()=>[f("i",{class:"search-icon"},[l(h,{icon:"iconsearch"})])])}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}]])},emits:["select"],setup:()=>({searchValue:j("")}),methods:{handleFetchSearch:async e=>R.map(a=>({value:a,label:a})),handleSelectSearch(e){this.$emit("select",e)}}});var de=g(p({name:"ProjectList",components:{NavigationNavBar:U,NavigationSideLogo:J,ProjectTableHeader:G,ProjectTableBody:K,SearchCorporation:g(Y,[["render",function(e,a,r,o,t,d){const s=c("SearchSelect");return m(),v(s,x({modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"\u641C\u7D22\u9879\u76EE","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}]])},setup(){const{proxy:e}=P(),a=H(),r=V();function o(t){a.dispatch(y.getAction("getProjectList"),{kw:t})}return o(),{localeInject:r,handleCreateProject:function(){const t=A({name:"",corpName:"",notes:""});e.$ModalDialog({title:r.t("project.create"),top:"10vh",width:"50vw","show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,renderComponent:{data:t,component:D},async onConfirm(d,s){if(!await d.validateRules())return Promise.reject(new Error("error"));s.fullLoading=!0;const{error:u,data:h}=await a.dispatch(y.getAction("createProject"),t);if(s.fullLoading=!1,u)return Promise.reject(new Error("error"));a.dispatch(y.getAction("getProjectList"))}})},handleSelectSearch:o}}}),[["render",function(e,a,r,o,t,d){const s=c("NavigationSideLogo"),u=c("NavigationNavBar"),h=c("IconFont"),S=c("el-button"),i=c("LayoutSection"),T=c("SearchCorporation"),L=c("ProjectTableHeader"),_=c("ProjectTableBody"),$=c("LayoutArea");return m(),v($,null,{top:n(()=>[l(u,{fixed:!1},{default:n(()=>[l(s)]),_:1})]),side:n(()=>[l(i,{title:e.localeInject.t("project.manageTitle")},{default:n(()=>[l(S,{type:"primary",class:"create-action",onClick:a[0]||(a[0]=ee=>e.handleCreateProject())},{default:n(()=>[l(h,{icon:"iconestablish"}),M(" "+w(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:n(()=>[l(i,{"has-divider":"","flex-content":""},{head:n(()=>[l(T,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:n(()=>[l(L),l(_)]),_:1})]),_:1})}],["__scopeId","data-v-6f6a921c"]]);export{de as default};
